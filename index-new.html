<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ç‚¹é¤ç³»ç»Ÿ - ç”¨æˆ·ç«¯</title>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .table-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .table-number {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .status-badge {
            background: #4CAF50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .search-box {
            position: relative;
            margin-bottom: 15px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
        }
        
        .search-box input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .category-nav {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .category-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .category-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* èœå“ç½‘æ ¼ */
        .dishes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 100px;
        }
        
        .dish-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .dish-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .dish-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        
        .dish-info {
            padding: 15px;
        }
        
        .dish-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .dish-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .dish-price {
            font-size: 20px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }
        
        .dish-stock {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .stock-low {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .stock-out {
            color: #95a5a6;
            font-weight: bold;
        }
        
        .add-to-cart {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            width: 100%;
        }
        
        .add-to-cart:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .add-to-cart:hover:not(:disabled) {
            background: #5a6fd8;
            transform: scale(1.05);
        }
        
        /* è´­ç‰©è½¦ */
        .cart-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .cart-btn {
            background: #e74c3c;
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            transition: all 0.3s;
            position: relative;
        }
        
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #2ecc71;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .cart-panel {
            position: absolute;
            bottom: 70px;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 350px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        .cart-panel.active {
            display: block;
        }
        
        .cart-items {
            padding: 15px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .cart-item-price {
            color: #666;
            font-size: 14px;
        }
        
        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            background: #f8f9fa;
            border: 1px solid #ddd;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cart-total {
            padding: 15px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }
        
        .total-amount {
            font-size: 18px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }
        
        .checkout-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .checkout-btn:hover {
            background: #27ae60;
            transform: scale(1.02);
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .dishes-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .cart-panel {
                width: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .dishes-grid {
                grid-template-columns: 1fr;
            }
            
            .cart-panel {
                width: 280px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¡Œå·ç»‘å®šæ¨¡æ€æ¡† -->
        <div class="modal" id="tableModal">
            <div class="modal-content">
                <h2 class="modal-title">æ¬¢è¿ä½¿ç”¨æ™ºèƒ½ç‚¹é¤ç³»ç»Ÿ</h2>
                <div class="form-group">
                    <label for="tableNumber">è¯·è¾“å…¥æ‚¨çš„æ¡Œå·</label>
                    <input type="text" id="tableNumber" placeholder="ä¾‹å¦‚ï¼šA01ã€2å·æ¡Œ" maxlength="10">
                </div>
                <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
                    æ¸©é¦¨æç¤ºï¼šè¯·ç¡®ä¿è¾“å…¥æ­£ç¡®çš„æ¡Œå·ï¼Œä»¥ä¾¿æœåŠ¡å‘˜ä¸ºæ‚¨å‡†ç¡®ä¸Šèœ
                </p>
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="bindTable()">ç¡®è®¤ç»‘å®š</button>
                </div>
            </div>
        </div>

        <!-- ä¸»é¡µé¢å†…å®¹ -->
        <div class="header">
            <div class="table-info">
                <div class="table-number" id="currentTable">è¯·ç»‘å®šæ¡Œå·</div>
                <div class="status-badge" id="tableStatus">æœªç»‘å®š</div>
            </div>
            
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢èœå“åç§°..." oninput="searchDishes()">
            </div>
            
            <div class="category-nav" id="categoryNav">
                <!-- åˆ†ç±»å¯¼èˆªå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- èœå“å±•ç¤ºåŒºåŸŸ -->
        <div class="dishes-grid" id="dishesGrid">
            <!-- èœå“å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- è´­ç‰©è½¦ -->
        <div class="cart-container">
            <div class="cart-panel" id="cartPanel">
                <div class="cart-items" id="cartItems">
                    <!-- è´­ç‰©è½¦å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="cart-total">
                    <div class="total-amount" id="totalAmount">åˆè®¡ï¼šÂ¥0.00</div>
                    <button class="checkout-btn" onclick="showCheckoutModal()">å»ç»“ç®—</button>
                </div>
            </div>
            <button class="cart-btn" onclick="toggleCart()">
                ğŸ›’
                <span class="cart-count" id="cartCount">0</span>
            </button>
        </div>

        <!-- ç»“ç®—ç¡®è®¤æ¨¡æ€æ¡† -->
        <div class="modal" id="checkoutModal">
            <div class="modal-content">
                <h2 class="modal-title">ç¡®è®¤è®¢å•</h2>
                <div class="form-group">
                    <label>æ¡Œå·</label>
                    <input type="text" id="confirmTable" readonly>
                </div>
                <div class="form-group">
                    <label>è®¢å•è¯¦æƒ…</label>
                    <div id="orderItems" style="border: 1px solid #e0e0e0; padding: 10px; border-radius: 8px; min-height: 100px;">
                        <!-- è®¢å•è¯¦æƒ…å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="orderRemark">å¤‡æ³¨</label>
                    <textarea id="orderRemark" placeholder="ä¾‹å¦‚ï¼šå°‘ç›ã€å¤šè¾£ã€å°½å¿«ä¸Šèœç­‰"></textarea>
                </div>
                <div style="font-size: 18px; font-weight: bold; text-align: center; margin: 20px 0; color: #e74c3c;" id="confirmTotal">
                    æ€»è®¡ï¼šÂ¥0.00
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-secondary" onclick="closeCheckoutModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="submitOrder()">æäº¤è®¢å•</button>
                </div>
            </div>
        </div>

        <!-- è®¢å•çŠ¶æ€æ¨¡æ€æ¡† -->
        <div class="modal" id="orderStatusModal">
            <div class="modal-content">
                <h2 class="modal-title" id="orderStatusTitle">è®¢å•çŠ¶æ€</h2>
                <div id="orderStatusContent">
                    <!-- è®¢å•çŠ¶æ€å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="closeOrderStatus()">ç¡®å®š</button>
                </div>
            </div>
        </div>
    </div>

    <script src="supabase-config.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let currentTable = '';
        let allDishes = [];
        let categories = [];
        let currentCategory = 'all';
        let cartVisible = false;

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkTableBinding();
            loadDishes();
            updateCartDisplay();
        });

        // æ£€æŸ¥æ¡Œå·ç»‘å®šçŠ¶æ€
        async function checkTableBinding() {
            const table = SessionService.getCurrentTable();
            if (table) {
                currentTable = table;
                document.getElementById('tableModal').classList.remove('active');
                document.getElementById('currentTable').textContent = `æ¡Œå·ï¼š${table}`;
                document.getElementById('tableStatus').textContent = 'å·²ç»‘å®š';
                document.getElementById('tableStatus').style.background = '#2ecc71';
            } else {
                document.getElementById('tableModal').classList.add('active');
            }
        }

        // ç»‘å®šæ¡Œå·
        function bindTable() {
            const tableNumber = document.getElementById('tableNumber').value.trim();
            if (!tableNumber) {
                alert('è¯·è¾“å…¥æ¡Œå·');
                return;
            }
            
            // ç®€å•æ ¡éªŒæ¡Œå·æ ¼å¼ï¼ˆå­—æ¯æˆ–æ•°å­—ï¼Œ1-10ä½ï¼‰
            if (!/^[A-Za-z0-9\u4e00-\u9fa5]{1,10}$/.test(tableNumber)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¡Œå·ï¼ˆ1-10ä½å­—æ¯ã€æ•°å­—æˆ–ä¸­æ–‡ï¼‰');
                return;
            }
            
            SessionService.setTableNumber(tableNumber);
            currentTable = tableNumber;
            document.getElementById('tableModal').classList.remove('active');
            document.getElementById('currentTable').textContent = `æ¡Œå·ï¼š${tableNumber}`;
            document.getElementById('tableStatus').textContent = 'å·²ç»‘å®š';
            document.getElementById('tableStatus').style.background = '#2ecc71';
            
            // åŠ è½½è¯¥æ¡Œå·çš„è®¢å•å†å²
            loadOrderHistory();
        }

        // åŠ è½½èœå“æ•°æ®
        async function loadDishes() {
            try {
                allDishes = await DishService.getAllDishes();
                
                // æå–åˆ†ç±»
                categories = [...new Set(allDishes.map(dish => dish.category))];
                categories.unshift('all'); // æ·»åŠ "å…¨éƒ¨"åˆ†ç±»
                
                renderCategories();
                renderDishes(allDishes);
                
            } catch (error) {
                console.error('åŠ è½½èœå“å¤±è´¥:', error);
                alert('åŠ è½½èœå“å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        // æ¸²æŸ“åˆ†ç±»å¯¼èˆª
        function renderCategories() {
            const categoryNav = document.getElementById('categoryNav');
            categoryNav.innerHTML = '';
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-btn';
                if (category === 'all') {
                    button.textContent = 'å…¨éƒ¨';
                    button.classList.add('active');
                } else {
                    button.textContent = category;
                }
                
                button.onclick = () => filterByCategory(category);
                categoryNav.appendChild(button);
            });
        }

        // æŒ‰åˆ†ç±»ç­›é€‰
        function filterByCategory(category) {
            currentCategory = category;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            let filteredDishes = allDishes;
            if (category !== 'all') {
                filteredDishes = allDishes.filter(dish => dish.category === category);
            }
            
            renderDishes(filteredDishes);
        }

        // æœç´¢èœå“
        function searchDishes() {
            const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
            
            if (!keyword) {
                renderDishes(allDishes);
                return;
            }
            
            const filteredDishes = allDishes.filter(dish => 
                dish.name.toLowerCase().includes(keyword) ||
                (dish.description && dish.description.toLowerCase().includes(keyword))
            );
            
            renderDishes(filteredDishes);
        }

        // æ¸²æŸ“èœå“ç½‘æ ¼
        function renderDishes(dishes) {
            const dishesGrid = document.getElementById('dishesGrid');
            dishesGrid.innerHTML = '';
            
            dishes.forEach(dish => {
                const dishCard = createDishCard(dish);
                dishesGrid.appendChild(dishCard);
            });
            
            if (dishes.length === 0) {
                dishesGrid.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">æš‚æ— èœå“</div>';
            }
        }

        // åˆ›å»ºèœå“å¡ç‰‡
        function createDishCard(dish) {
            const card = document.createElement('div');
            card.className = 'dish-card';
            
            const isAvailable = dish.status === 1 && dish.stock > 0;
            const stockInfo = getStockInfo(dish.stock);
            
            card.innerHTML = `
                <img src="${dish.image_url || 'https://via.placeholder.com/300x180?text=èœå“å›¾ç‰‡'}" 
                     alt="${dish.name}" class="dish-image" 
                     onerror="this.src='https://via.placeholder.com/300x180?text=å›¾ç‰‡åŠ è½½å¤±è´¥'">
                <div class="dish-info">
                    <div class="dish-name">${dish.name}</div>
                    <div class="dish-description">${dish.description || 'æš‚æ— æè¿°'}</div>
                    <div class="dish-price">Â¥${dish.price.toFixed(2)}</div>
                    <div class="dish-stock ${stockInfo.class}">${stockInfo.text}</div>
                    <button class="add-to-cart" 
                            onclick="addToCart('${dish.id}')"
                            ${!isAvailable ? 'disabled' : ''}>
                        ${isAvailable ? 'åŠ å…¥è´­ç‰©è½¦' : 'å·²å”®ç½„'}
                    </button>
                </div>
            `;
            
            return card;
        }

        // è·å–åº“å­˜ä¿¡æ¯
        function getStockInfo(stock) {
            if (stock === 0) {
                return { class: 'stock-out', text: 'å·²å”®ç½„' };
            } else if (stock <= 3) {
                return { class: 'stock-low', text: `ä»…å‰© ${stock} ä»½` };
            } else {
                return { class: '', text: 'åº“å­˜å……è¶³' };
            }
        }

        // æ·»åŠ åˆ°è´­ç‰©è½¦
        async function addToCart(dishId) {
            if (!currentTable) {
                alert('è¯·å…ˆç»‘å®šæ¡Œå·');
                return;
            }
            
            const dish = allDishes.find(d => d.id === dishId);
            if (!dish) return;
            
            // æ£€æŸ¥åº“å­˜
            const hasStock = await DishService.checkStock(dishId, 1);
            if (!hasStock) {
                alert(`${dish.name} åº“å­˜ä¸è¶³`);
                return;
            }
            
            CartService.addToCart(dish, 1);
            updateCartDisplay();
            
            // æ˜¾ç¤ºæ·»åŠ æˆåŠŸæç¤º
            showToast(`å·²æ·»åŠ  ${dish.name} åˆ°è´­ç‰©è½¦`);
        }

        // æ›´æ–°è´­ç‰©è½¦æ˜¾ç¤º
        function updateCartDisplay() {
            const cart = CartService.getCart();
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const totalAmount = document.getElementById('totalAmount');
            
            cartCount.textContent = CartService.getTotalCount();
            totalAmount.textContent = `åˆè®¡ï¼šÂ¥${CartService.getTotalAmount().toFixed(2)}`;
            
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">è´­ç‰©è½¦ä¸ºç©º</div>';
                return;
            }
            
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">Â¥${item.price.toFixed(2)}</div>
                    </div>
                    <div class="cart-item-controls">
                        <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})">-</button>
                        <span style="min-width: 30px; text-align: center;">${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})">+</button>
                        <button class="quantity-btn" onclick="removeFromCart('${item.id}')" style="margin-left: 10px;">Ã—</button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
        }

        // æ›´æ–°è´­ç‰©è½¦æ•°é‡
        async function updateCartQuantity(dishId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(dishId);
                return;
            }
            
            const cartItem = CartService.getCart().find(item => item.id === dishId);
            if (!cartItem) return;
            
            // æ£€æŸ¥åº“å­˜
            const hasStock = await DishService.checkStock(dishId, newQuantity);
            if (!hasStock) {
                alert(`åº“å­˜ä¸è¶³ï¼Œæœ€å¤šå¯ç‚¹ ${cartItem.maxStock} ä»½`);
                return;
            }
            
            CartService.updateQuantity(dishId, newQuantity);
            updateCartDisplay();
        }

        // ä»è´­ç‰©è½¦ç§»é™¤
        function removeFromCart(dishId) {
            CartService.removeFromCart(dishId);
            updateCartDisplay();
        }

        // åˆ‡æ¢è´­ç‰©è½¦æ˜¾ç¤º
        function toggleCart() {
            const cartPanel = document.getElementById('cartPanel');
            cartVisible = !cartVisible;
            cartPanel.classList.toggle('active', cartVisible);
        }

        // æ˜¾ç¤ºç»“ç®—æ¨¡æ€æ¡†
        function showCheckoutModal() {
            if (!currentTable) {
                alert('è¯·å…ˆç»‘å®šæ¡Œå·');
                return;
            }
            
            const cart = CartService.getCart();
            if (cart.length === 0) {
                alert('è´­ç‰©è½¦ä¸ºç©ºï¼Œè¯·å…ˆæ·»åŠ èœå“');
                return;
            }
            
            document.getElementById('confirmTable').value = currentTable;
            document.getElementById('confirmTotal').textContent = `æ€»è®¡ï¼šÂ¥${CartService.getTotalAmount().toFixed(2)}`;
            
            // æ¸²æŸ“è®¢å•è¯¦æƒ…
            const orderItems = document.getElementById('orderItems');
            orderItems.innerHTML = cart.map(item => 
                `<div style="margin-bottom: 5px;">${item.name} Ã— ${item.quantity} = Â¥${item.subtotal.toFixed(2)}</div>`
            ).join('');
            
            document.getElementById('checkoutModal').classList.add('active');
        }

        // å…³é—­ç»“ç®—æ¨¡æ€æ¡†
        function closeCheckoutModal() {
            document.getElementById('checkoutModal').classList.remove('active');
        }

        // æäº¤è®¢å•
        async function submitOrder() {
            try {
                const cart = CartService.getCart();
                const remark = document.getElementById('orderRemark').value.trim();
                
                const orderData = {
                    tableNum: currentTable,
                    totalAmount: CartService.getTotalAmount(),
                    remark: remark,
                    cartItems: cart
                };
                
                const order = await OrderService.createOrder(orderData);
                
                // æ¸…ç©ºè´­ç‰©è½¦
                CartService.clearCart();
                updateCartDisplay();
                closeCheckoutModal();
                
                // æ˜¾ç¤ºè®¢å•æäº¤æˆåŠŸ
                showOrderStatus(order, 'submitted');
                
            } catch (error) {
                console.error('æäº¤è®¢å•å¤±è´¥:', error);
                alert(`æäº¤è®¢å•å¤±è´¥ï¼š${error.message}`);
            }
        }

        // æ˜¾ç¤ºè®¢å•çŠ¶æ€
        function showOrderStatus(order, status) {
            const modal = document.getElementById('orderStatusModal');
            const title = document.getElementById('orderStatusTitle');
            const content = document.getElementById('orderStatusContent');
            
            if (status === 'submitted') {
                title.textContent = 'è®¢å•æäº¤æˆåŠŸ';
                content.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 48px; color: #2ecc71; margin-bottom: 20px;">âœ“</div>
                        <div style="font-size: 18px; margin-bottom: 10px;">è®¢å•å·ï¼š${order.id.substring(0, 8)}...</div>
                        <div style="color: #666; margin-bottom: 20px;">è¯·ç­‰å¾…å•†å®¶æ¥å•ï¼Œæ‚¨å¯ä»¥åœ¨"æˆ‘çš„è®¢å•"ä¸­æŸ¥çœ‹çŠ¶æ€</div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <div>æ¡Œå·ï¼š${order.table_num}</div>
                            <div>æ€»é‡‘é¢ï¼šÂ¥${order.total_amount.toFixed(2)}</div>
                            ${order.remark ? `<div>å¤‡æ³¨ï¼š${order.remark}</div>` : ''}
                        </div>
                    </div>
                `;
            }
            
            modal.classList.add('active');
        }

        // å…³é—­è®¢å•çŠ¶æ€æ¨¡æ€æ¡†
        function closeOrderStatus() {
            document.getElementById('orderStatusModal').classList.remove('active');
        }

        // æ˜¾ç¤ºToastæç¤º
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #2ecc71;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 3000;
                animation: slideIn 0.3s, slideOut 0.3s 2s forwards;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 2300);
        }

        // åŠ è½½è®¢å•å†å²ï¼ˆç®€åŒ–ç‰ˆï¼‰
        async function loadOrderHistory() {
            // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨OrderService.getOrdersByTable(currentTable)
            console.log('åŠ è½½è®¢å•å†å²:', currentTable);
        }

        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>